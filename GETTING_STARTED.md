# Getting Started with Coral Ontogeny Analysis

This guide will help you get up and running with the complete data science and visualization platform.

---

## Prerequisites

### Required Software

**For R Analysis**:
- R 4.4.0 or higher
- RStudio (recommended) OR R command line
- macOS, Linux, or Windows

**For Web Visualization**:
- Node.js 18+ and npm 9+
- Modern web browser (Chrome, Firefox, Safari, Edge)

---

## Installation

### Step 1: Clone Repository

```bash
git clone https://github.com/adrianstier/coral-ontogeny-viz.git
cd coral-ontogeny-viz
```

### Step 2: Set Up R Environment

```bash
# Install renv package manager
R -e "install.packages('renv')"

# Restore R package environment
R -e "renv::restore()"
```

This will install all required R packages (~15 packages) with correct versions.

**Time**: ~5-10 minutes depending on connection

### Step 3: Set Up Web App (Optional)

```bash
# Install Node.js dependencies
npm install
```

**Time**: ~2-3 minutes

---

## Quick Start Workflows

### Workflow 1: Run Complete R Analysis

**Goal**: Generate all analyses, figures, and reports

```bash
# Run master pipeline script
Rscript scripts/R/run_complete_pipeline.R
```

This will:
1. âœ“ Validate data quality (~30s)
2. âœ“ Transform Excel â†’ CSV/Parquet (~45s)
3. âœ“ Generate 5 main figures + 2 supplementary (~60s)
4. âœ“ Render 4 R Markdown notebooks (~5min)
5. âœ“ Create HTML reports with navigation

**Total time**: ~7 minutes

**View results**:
```bash
# On macOS
open outputs/reports/index.html

# On Linux
xdg-open outputs/reports/index.html

# On Windows
start outputs/reports/index.html
```

### Workflow 2: Interactive Analysis in RStudio

1. Open RStudio
2. Navigate to `notebooks/` directory
3. Open any `.Rmd` file (e.g., `02_demographic_analysis.Rmd`)
4. Click "Knit" button to generate HTML report

**Recommended order**:
1. `01_data_exploration.Rmd` - Data overview
2. `02_demographic_analysis.Rmd` - Population dynamics
3. `03_survival_analysis.Rmd` - Survival curves
4. `04_spatial_analysis.Rmd` - Spatial patterns

### Workflow 3: Generate Specific Outputs

**Just validate data quality**:
```bash
Rscript scripts/R/01_validate_data.R
# â†’ outputs/reports/data_quality_report.html
```

**Just create tidy dataset**:
```bash
Rscript scripts/R/02_transform_data.R
# â†’ data/processed/coral_long_format.csv
```

**Just generate publication figures**:
```bash
Rscript scripts/R/04_generate_figures.R
# â†’ outputs/figures/*.png, *.pdf
```

**Export data for web app**:
```bash
Rscript scripts/R/03_export_for_webapp.R
# â†’ public/data/*.json, *.csv
```

### Workflow 4: Web App Development

```bash
# Start development server
npm run dev

# Open browser to http://localhost:5173
```

The app will load data from:
- `public/data/` (if available from R export)
- OR `data/raw/` (Excel file directly)

---

## Understanding the Directory Structure

```
coral-ontogeny-viz/
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ raw/                    # â† Original Excel file (immutable)
â”‚   â”‚   â””â”€â”€ LTER_*.xlsx
â”‚   â”œâ”€â”€ processed/              # â† Generated by R scripts
â”‚   â”‚   â”œâ”€â”€ coral_long_format.csv
â”‚   â”‚   â””â”€â”€ coral_enriched.parquet
â”‚   â””â”€â”€ external/               # â† Reference data (if any)
â”‚
â”œâ”€â”€ scripts/R/                  # â† R analysis scripts
â”‚   â”œâ”€â”€ utils.R                 # Helper functions
â”‚   â”œâ”€â”€ 01_validate_data.R      # QA checks
â”‚   â”œâ”€â”€ 02_transform_data.R     # Data processing
â”‚   â”œâ”€â”€ 03_export_for_webapp.R  # Web app exports
â”‚   â”œâ”€â”€ 04_generate_figures.R   # Publication figures
â”‚   â””â”€â”€ 05_generate_report.R    # HTML reports
â”‚
â”œâ”€â”€ notebooks/                  # â† R Markdown analyses
â”‚   â”œâ”€â”€ 01_data_exploration.Rmd
â”‚   â”œâ”€â”€ 02_demographic_analysis.Rmd
â”‚   â”œâ”€â”€ 03_survival_analysis.Rmd
â”‚   â””â”€â”€ 04_spatial_analysis.Rmd
â”‚
â”œâ”€â”€ outputs/                    # â† Generated outputs
â”‚   â”œâ”€â”€ figures/                # PNG/PDF publication figures
â”‚   â”œâ”€â”€ reports/                # HTML analysis reports
â”‚   â””â”€â”€ exports/                # User data exports
â”‚
â”œâ”€â”€ tests/                      # â† Unit tests
â”‚   â””â”€â”€ unit/test_utils.R       # R function tests
â”‚
â”œâ”€â”€ src/                        # â† React web app
â”‚   â””â”€â”€ ...                     # TypeScript/React code
â”‚
â””â”€â”€ public/data/                # â† Web app data (from R export)
    â””â”€â”€ *.json, *.csv
```

---

## Common Tasks

### Task 1: Analyze New Data

1. **Replace Excel file** in `data/raw/`
2. **Update metadata.json** with new info
3. **Run validation**: `Rscript scripts/R/01_validate_data.R`
4. **Check quality report**: `outputs/reports/data_quality_report.html`
5. **If OK, run pipeline**: `Rscript scripts/R/run_complete_pipeline.R`

### Task 2: Create Custom Analysis

1. **Create new notebook**: `notebooks/05_my_analysis.Rmd`
2. **Copy template** from existing notebook
3. **Load data**: `coral_data <- read_csv(here("data/processed/coral_long_format.csv"))`
4. **Add analysis sections** with R code + markdown
5. **Knit to HTML** in RStudio or:
   ```bash
   Rscript -e "rmarkdown::render('notebooks/05_my_analysis.Rmd')"
   ```

### Task 3: Modify Figures

1. **Edit** `scripts/R/04_generate_figures.R`
2. **Find figure** you want to modify (e.g., Figure 2)
3. **Update ggplot code**:
   ```r
   # Change colors
   scale_color_manual(values = c("red", "blue", "green"))

   # Adjust theme
   theme_minimal(base_size = 14)

   # Change dimensions
   ggsave("output.png", width = 12, height = 8, dpi = 300)
   ```
4. **Re-run**: `Rscript scripts/R/04_generate_figures.R`

### Task 4: Export New Data Format

1. **Edit** `scripts/R/03_export_for_webapp.R`
2. **Add new export** section:
   ```r
   # Create custom dataset
   my_data <- coral_data %>%
     filter(year == 2023) %>%
     select(coral_id, genus, x, y, diameter = geom_mean_diam)

   # Export
   write_json(my_data, "public/data/my_custom_data.json")
   ```
3. **Re-run**: `Rscript scripts/R/03_export_for_webapp.R`

### Task 5: Add Utility Function

1. **Edit** `scripts/R/utils.R`
2. **Add function**:
   ```r
   #' Calculate coral surface area
   #'
   #' @param diam1 First diameter (cm)
   #' @param diam2 Second diameter (cm)
   #' @return Surface area estimate (cmÂ²)
   calc_surface_area <- function(diam1, diam2) {
     if (any(is.na(c(diam1, diam2)))) return(NA_real_)
     pi * (diam1 / 2) * (diam2 / 2)
   }
   ```
3. **Add test** in `tests/unit/test_utils.R`:
   ```r
   test_that("calc_surface_area works correctly", {
     expect_equal(calc_surface_area(10, 10), pi * 25, tolerance = 0.01)
   })
   ```
4. **Run tests**: `Rscript -e "testthat::test_file('tests/unit/test_utils.R')"`

---

## Troubleshooting

### R Package Installation Issues

**Error**: "package X is not available"

**Solution**:
```r
# Update renv
install.packages("renv")

# Try restore again
renv::restore()

# If still fails, install individually
install.packages("tidyverse")
install.packages("survival")
```

### File Not Found Errors

**Error**: "cannot open file 'data/raw/...'"

**Solution**:
```r
# Check working directory
getwd()  # Should be project root

# Set if needed
setwd("/path/to/coral-ontogeny-viz")

# OR always use here() package
library(here)
here("data/raw/my_file.xlsx")  # Automatically finds project root
```

### Memory Issues

**Error**: "cannot allocate vector of size..."

**Solution**:
```r
# Increase R memory limit (Windows)
memory.limit(size = 16000)  # 16 GB

# Process in chunks
years <- unique(coral_data$year)
for (yr in years) {
  subset <- coral_data %>% filter(year == yr)
  process_and_save(subset, yr)
}
```

### Excel File Locked

**Error**: "Permission denied" when reading Excel

**Solution**:
1. Close Excel application
2. Check no other R sessions are open
3. Restart R session

### Notebook Won't Knit

**Error**: Rendering fails with cryptic message

**Solution**:
```r
# Clear knitr cache
knitr::clean_cache()

# Try rendering from console instead of RStudio
rmarkdown::render("notebooks/01_data_exploration.Rmd")

# Check for errors in code chunks
# Run chunks individually in RStudio to find issue
```

---

## Next Steps

### For Data Analysts

1. âœ“ Run complete pipeline
2. â†’ Explore notebooks in RStudio
3. â†’ Modify analyses for your research questions
4. â†’ Create custom figures
5. â†’ Export results for publication

**Resources**:
- [scripts/R/README.md](scripts/R/README.md) - Detailed script documentation
- [notebooks/README.md](notebooks/README.md) - Notebook execution guide
- [DATA_DICTIONARY.md](DATA_DICTIONARY.md) - Variable definitions

### For Web Developers

1. âœ“ Run R data export script
2. â†’ Start web app dev server
3. â†’ Explore React components
4. â†’ Integrate R-generated data
5. â†’ Build interactive visualizations

**Resources**:
- [QUICKSTART.md](QUICKSTART.md) - Web app quick start
- [src/README.md](src/README.md) - React app documentation
- [public/data/manifest.json](public/data/manifest.json) - Data API

### For Reproducible Research

1. âœ“ Understand directory structure
2. â†’ Document your workflow
3. â†’ Use version control (git)
4. â†’ Archive raw data
5. â†’ Share code and reports

**Resources**:
- [CLAUDE.md](CLAUDE.md) - Implementation guide
- [REPO_ORGANIZATION_SUMMARY.md](REPO_ORGANIZATION_SUMMARY.md) - Project overview

---

## Getting Help

### Documentation Index

| Document | Purpose |
|----------|---------|
| **GETTING_STARTED.md** (this file) | Initial setup and quick start |
| [README.md](README.md) | Project overview |
| [scripts/R/README.md](scripts/R/README.md) | R script documentation |
| [notebooks/README.md](notebooks/README.md) | Notebook execution guide |
| [DATA_DICTIONARY.md](DATA_DICTIONARY.md) | Variable definitions |
| [CLAUDE.md](CLAUDE.md) | Implementation details |
| [REPO_ORGANIZATION_SUMMARY.md](REPO_ORGANIZATION_SUMMARY.md) | Complete project summary |

### Common Questions

**Q: Which script should I run first?**
A: Start with `run_complete_pipeline.R` to generate everything, or run scripts 01-05 individually in order.

**Q: Can I skip the web app and just use R?**
A: Absolutely! The R analysis is completely standalone. The web app is an optional interactive visualization layer.

**Q: How do I update to new data?**
A: Replace Excel file in `data/raw/`, update `metadata.json`, run validation, then re-run pipeline.

**Q: Can I use Python instead of R?**
A: The current pipeline is R-based, but you could port scripts to Python. The data dictionary and structure would remain the same.

**Q: How do I cite this project?**
A: See the README for citation information for the dataset and analysis code.

---

## Support

For issues or questions:
1. Check documentation above
2. Review [CLAUDE.md](CLAUDE.md) for implementation details
3. Search existing GitHub issues
4. Open new issue with:
   - What you tried
   - Error message (full output)
   - Your system info (R version, OS)

---

**Last Updated**: 2026-01-12

**Welcome to the Coral Ontogeny Analysis Platform!** ğŸª¸

Start with `Rscript scripts/R/run_complete_pipeline.R` and explore from there.
